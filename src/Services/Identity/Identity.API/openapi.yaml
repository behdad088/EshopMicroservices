openapi: 3.0.0
info:
  title: Duende IdentityServer API
  version: 1.0.0
  description: |
    This is the API for the Duende IdentityServer. It provides endpoints for OpenID Connect and OAuth 2.0 flows.
servers:
  - url: https://localhost:5001
    description: Local development server
paths:
  /.well-known/openid-configuration:
    get:
      summary: Discovery Endpoint
      description: >-
        Publishes metadata about the IdentityServer instance, including links to
        all other endpoints and supported features.
      responses:
        '200':
          description: OK
  /connect/authorize:
    get:
      summary: Authorize Endpoint
      description: >-
        Clients use this endpoint to initiate authentication requests and obtain
        authorization codes or tokens through the user's browser.
      parameters:
        - $ref: '#/components/parameters/client_id'
        - $ref: '#/components/parameters/scope'
        - $ref: '#/components/parameters/redirect_uri'
        - $ref: '#/components/parameters/response_type'
      responses:
        '302':
          description: Redirect
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /connect/token:
    post:
      summary: Token Endpoint
      description: >-
        This endpoint allows clients to programmatically request various
        tokens, such as access tokens and refresh tokens, using different grant
        types.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/TokenRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /connect/userinfo:
    get:
      summary: User Info Endpoint
      description: >-
        After obtaining an access token, clients can use this endpoint to
        retrieve claims (information) about the authenticated user.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /connect/endsession:
    get:
      summary: End Session Endpoint
      description: >-
        This endpoint facilitates user logout from IdentityServer and
        potentially from client applications.
      parameters:
        - $ref: '#/components/parameters/id_token_hint'
        - $ref: '#/components/parameters/post_logout_redirect_uri'
        - $ref: '#/components/parameters/state'
      responses:
        '302':
          description: Redirect
  /connect/checksession:
    get:
      summary: Check Session Endpoint
      description: >-
        Used for front-channel logout mechanisms to monitor the user's session
        status.
      responses:
        '200':
          description: OK
  /connect/revocation:
    post:
      summary: Token Revocation Endpoint
      description: >-
        Clients can use this to revoke access and refresh tokens they have
        previously received.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/RevocationRequest'
      responses:
        '200':
          description: OK
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /connect/introspect:
    post:
      summary: Introspection Endpoint
      description: >-
        This endpoint allows resource servers to validate the status and
        contents of an access token.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/IntrospectionRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IntrospectionResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /connect/deviceauthorization:
    post:
      summary: Device Authorization Endpoint
      description: >-
        Supports the OAuth 2.0 Device Authorization Grant for input-constrained
        devices.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/DeviceAuthorizationRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceAuthorizationResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /connect/ciba:
    post:
      summary: Backchannel Authentication Endpoint
      description: >-
        Used in Client Initiated Backchannel Authentication (CIBA) flows.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/CibaRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CibaResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /connect/par:
    post:
      summary: Pushed Authorization Request (PAR) Endpoint
      description: >-
        Allows clients to push the authorization request parameters directly to
        the authorization server before redirecting the user agent.
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ParRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /login:
    post:
      summary: Login Endpoint
      description: >-
        Authenticates a user with a username and password.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /register:
    post:
      summary: Register Endpoint
      description: >-
        Creates a new user.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Created
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /logout:
    post:
      summary: Logout Endpoint
      description: >-
        Logs out the current user.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
  /refresh:
    post:
      summary: Refresh Endpoint
      description: >-
        Refreshes an access token.
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshResponse'
  /forgot-password:
    post:
      summary: Forgot Password Endpoint
      description: >-
        Sends a password reset link to a user's email address.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
      responses:
        '200':
          description: OK
  /reset-password:
    post:
      summary: Reset Password Endpoint
      description: >-
        Resets a user's password.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '200':
          description: OK
  /verify-email:
    post:
      summary: Verify Email Endpoint
      description: >-
        Verifies a user's email address.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyEmailRequest'
      responses:
        '200':
          description: OK
  /resend-verification-email:
    post:
      summary: Resend Verification Email Endpoint
      description: >-
        Resends a verification email to a user's email address.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResendVerificationEmailRequest'
      responses:
        '200':
          description: OK
  /user:
    get:
      summary: User Endpoint
      description: >-
        Gets the current user's information.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
  /user/{id}:
    get:
      summary: User Endpoint
      description: >-
        Gets a user's information by their ID.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          description: The user's ID.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    put:
      summary: User Endpoint
      description: >-
        Updates a user's information.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          description: The user's ID.
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    delete:
      summary: User Endpoint
      description: >-
        Deletes a user.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          description: The user's ID.
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
  /users:
    get:
      summary: Users Endpoint
      description: >-
        Gets a list of all users.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
  /roles:
    get:
      summary: Roles Endpoint
      description: >-
        Gets a list of all roles.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
    post:
      summary: Roles Endpoint
      description: >-
        Creates a new role.
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRoleRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
  /role/{id}:
    get:
      summary: Role Endpoint
      description: >-
        Gets a role by its ID.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          description: The role's ID.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
    put:
      summary: Role Endpoint
      description: >-
        Updates a role.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          description: The role's ID.
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoleRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
    delete:
      summary: Role Endpoint
      description: >-
        Deletes a role.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          description: The role's ID.
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
  /user/{id}/roles:
    get:
      summary: User Roles Endpoint
      description: >-
        Gets a list of a user's roles.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          description: The user's ID.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
    post:
      summary: User Roles Endpoint
      description: >-
        Assigns a role to a user.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          description: The user's ID.
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignRoleRequest'
      responses:
        '204':
          description: No Content
  /user/{id}/roles/{roleId}:
    delete:
      summary: User Roles Endpoint
      description: >-
        Removes a role from a user.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          description: The user's ID.
          required: true
          schema:
            type: string
        - name: roleId
          in: path
          description: The role's ID.
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
components:
  schemas:
    TokenRequest:
      type: object
      properties:
        grant_type:
          type: string
          description: The grant type being used.
          enum:
            - authorization_code
            - client_credentials
            - password
            - refresh_token
            - urn:ietf:params:oauth:grant-type:device_code
        client_id:
          type: string
          description: The client identifier.
        client_secret:
          type: string
          description: The client secret.
        code:
          type: string
          description: The authorization code.
        redirect_uri:
          type: string
          description: The redirect URI.
        code_verifier:
          type: string
          description: The PKCE proof key.
        username:
          type: string
          description: The resource owner username.
        password:
          type: string
          description: The resource owner password.
        scope:
          type: string
          description: One or more registered scopes.
        refresh_token:
          type: string
          description: The refresh token.
      required:
        - grant_type
        - client_id
    TokenResponse:
      type: object
      properties:
        access_token:
          type: string
        expires_in:
          type: integer
        token_type:
          type: string
        refresh_token:
          type: string
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
    RevocationRequest:
      type: object
      properties:
        token:
          type: string
          description: The token to be revoked.
        token_type_hint:
          type: string
          description: A hint indicating the type of token being revoked.
          enum:
            - access_token
            - refresh_token
      required:
        - token
    IntrospectionRequest:
      type: object
      properties:
        token:
          type: string
          description: The token to be introspected.
        token_type_hint:
          type: string
          description: A hint indicating the type of token being introspected.
          enum:
            - access_token
            - refresh_token
      required:
        - token
    IntrospectionResponse:
      type: object
      properties:
        active:
          type: boolean
        scope:
          type: string
        client_id:
          type: string
        token_type:
          type: string
    DeviceAuthorizationRequest:
      type: object
      properties:
        client_id:
          type: string
          description: The client identifier.
        scope:
          type: string
          description: One or more registered scopes.
      required:
        - client_id
    DeviceAuthorizationResponse:
      type: object
      properties:
        device_code:
          type: string
        user_code:
          type: string
        verification_uri:
          type: string
        expires_in:
          type: integer
    CibaRequest:
      type: object
      properties:
        client_id:
          type: string
          description: The client identifier.
        client_secret:
          type: string
          description: The client secret.
        scope:
          type: string
          description: One or more registered scopes.
        login_hint:
          type: string
          description: A hint to the authorization server about the login identifier the end-user might use to log in.
      required:
        - client_id
        - scope
    CibaResponse:
      type: object
      properties:
        auth_req_id:
          type: string
        expires_in:
          type: integer
    ParRequest:
      type: object
      properties:
        client_id:
          type: string
          description: The client identifier.
        client_secret:
          type: string
          description: The client secret.
        scope:
          type: string
          description: One or more registered scopes.
        response_type:
          type: string
          description: The desired response type.
      required:
        - client_id
        - response_type
    ParResponse:
      type: object
      properties:
        request_uri:
          type: string
        expires_in:
          type: integer
    LoginRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required:
        - username
        - password
    LoginResponse:
      type: object
      properties:
        token:
          type: string
    RegisterRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
        email:
          type: string
      required:
        - username
        - password
        - email
    RefreshRequest:
      type: object
      properties:
        refresh_token:
          type: string
      required:
        - refresh_token
    RefreshResponse:
      type: object
      properties:
        token:
          type: string
    ForgotPasswordRequest:
      type: object
      properties:
        email:
          type: string
      required:
        - email
    ResetPasswordRequest:
      type: object
      properties:
        email:
          type: string
        token:
          type: string
        password:
          type: string
      required:
        - email
        - token
        - password
    VerifyEmailRequest:
      type: object
      properties:
        email:
          type: string
        token:
          type: string
      required:
        - email
        - token
    ResendVerificationEmailRequest:
      type: object
      properties:
        email:
          type: string
      required:
        - email
    User:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        email:
          type: string
    UpdateUserRequest:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
    Role:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
    CreateRoleRequest:
      type: object
      properties:
        name:
          type: string
      required:
        - name
    UpdateRoleRequest:
      type: object
      properties:
        name:
          type: string
      required:
        - name
    AssignRoleRequest:
      type: object
      properties:
        role_id:
          type: string
      required:
        - role_id
  parameters:
    client_id:
      name: client_id
      in: query
      description: The client identifier.
      required: true
      schema:
        type: string
    scope:
      name: scope
      in: query
      description: One or more registered scopes.
      required: true
      schema:
        type: string
    redirect_uri:
      name: redirect_uri
      in: query
      description: The redirect URI.
      required: true
      schema:
        type: string
    response_type:
      name: response_type
      in: query
      description: The desired response type.
      required: true
      schema:
        type: string
        enum:
          - id_token
          - token
          - id_token token
          - code
          - code id_token
          - code id_token token
    id_token_hint:
      name: id_token_hint
      in: query
      description: The ID token.
      required: false
      schema:
        type: string
    post_logout_redirect_uri:
      name: post_logout_redirect_uri
      in: query
      description: The post-logout redirect URI.
      required: false
      schema:
        type: string
    state:
      name: state
      in: query
      description: The state.
      required: false
      schema:
        type: string
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
